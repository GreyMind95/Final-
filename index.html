<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="css/finalooks.css">
    <title></title>
  </head>

  <body onload="retrieveNote()">
  
<header>
  <div class="container center">
    <h1>Ready Note</h1>
  </div>
</header>
<!--Menu option for NotePad-->
<div class="container-div">
    <div class="container left">
      <div class="row">
        <!--Input Section-->
        <div class="col-5">
          <h1>Start New Note</h1>
      <!--Create name of Note-->
            <input id="nameTitle" type="text" placeholder="Enter Title">
      <!--Select Importance of Note by color-->
              <select id="colorCode">
              <option>-Status Code-</option>
              <option value="red">Red</option>
              <option value="yellow">Yellow</option>
              <option value="green">Green</option>
              <option value="gray">Gray</option>
              </select>
                <input type="button" value="Submit" onclick="uploadNote()">
                <input type="button" value="Order" onclick="prioritizeNotes()">

                  <br>
          <div class="col">
          <textarea id="textBox" name="advanced"
            rows="10" cols="60" maxlength="200"
            wrap="hard">
          </textarea>
          </div>
        </div>
       </div>
       <div id="showNote" class="container left size"></div>
        </div>
        <hr>
<!--Retrieve & Edit Note Section-->
    <div class="container-right">
        <div class="row">
            <div class="col-5">
            <h1>Retrieve Note Section</h1>
        <!--Search name of Note-->
        <!--Change Importance of Note by color-->
        <select id="noteChoices">
            <option>-Select-</option>
            <option value="title">Title</option>
            <option value="color">Color</option>
            <option value="time">Time</option>
            </select>
            <input id="searchTitle" type="text" placeholder="Enter Selection">
            <input type="button" value="Submit" placeholder="Submit" onclick="makeNotes()">
            
            <br>
          </div>
           </div>
            </div>
            <hr>
            <div class="container-middle">
                <div class="row">
                  <div class="col-5">
                    <h1>Remove Note</h1>
                    <input id="remove" type="text" placeholder="Enter note title">
                    <input type="button" value="Remove" onclick="removeNote()">
                      <br>
                </div>

                <div class="col-5">
                    <h1>Archive Note</h1>
                    <input id="archive" type="text" placeholder="Enter note title">
                    <input type="button" value="Remove" onclick="archiveNote()">
                      <br> <br>
                </div>
                 </div>
              </div>
             </div>
<br>
<div id="showNote" class="container left size"></div>

<script src="http://cdn.jsdelivr.net/alasql/latest/alasql.min.js"></script>
<script>
var db = new alasql.Database();
//Create table for title, date, message, and importance
db.exec(`CREATE TABLE notes (id int PRIMARY KEY, title varchar(255), color varchar(255), message varchar(255), date varchar(225))`);

db.exec(`CREATE TABLE archives (id int PRIMARY KEY, title varchar(255), color varchar(255), message varchar(255), date varchar(225))`);


  if(localStorage.noteBox != undefined){
    var store = JSON.parse(localStorage.noteBox);

    for (var i=0; i < store.length; i++){
      db.exec(`INSERT INTO notes VALUES(${store[i].id}, "${store[i].title}", "${store[i].color}" ,"${store[i].message}", "${store[i].date}")`);
    }
  }

   if(localStorage.archiveNotes != undefined){
    var store = JSON.parse(localStorage.archiveNotes);

    for (var i=0; i < store.length; i++){
      db.exec(`INSERT INTO notes VALUES(${store[i].id}, "${store[i].title}", "${store[i].color}" ,"${store[i].message}", "${store[i].date}")`);
    }
  }


//Sorts the saved notes by importance.
//List of functions and variables


function uploadNote(){
  
  var id = db.exec('SELECT * FROM notes').length;
  var title = document.getElementById("nameTitle").value;
  var message = document.getElementById("textBox").value;
  var color = document.getElementById("colorCode").value;
  var text = document.getElementById("textBox").value;
  var date = new Date().toString();
  alert("Note has been saved");
console.log(title, color, text);
  db.exec(`INSERT INTO notes VALUES(${id}, "${title}", "${color}" ,"${message}", "${date}")`);
var result = db.exec(`SELECT * FROM notes`);
localStorage.noteBox = JSON.stringify(result);

console.log(JSON.stringify(result));
//Creates new div for each entry
var newDiv = document.createElement("div");
newDiv.id = id;
newDiv.className = "row";
newDiv.style.backgroundColor = color;
newDiv.innerHTML += `<p>${title}</p>`
// newDiv.innerHTML += `<p>${color}</p>`
newDiv.innerHTML += `<p>${text}</p>`
newDiv.innerHTML += `<p>${date}</p>`
//Creates new div for next entry
document.getElementById("showNote").appendChild(newDiv);  

}
//Loads stored entries onto webpage
function retrieveNote(){
  if(localStorage.noteBox != undefined){
   var noteBox = JSON.parse(localStorage.noteBox);

   document.getElementById("showNote").innerHTML = "";


   for(var i=0; i < noteBox.length; i++){
      var newDiv = document.createElement("div");
      newDiv.id = noteBox[i].id
        newDiv.className = "row";
        newDiv.style.backgroundColor = noteBox[i].color;
        newDiv.innerHTML += `<p>${noteBox[i].title}</p>`
        newDiv.innerHTML += `<p>${noteBox[i].message}</p>`
        newDiv.innerHTML += `<p>${noteBox[i].date}</p>`
        newDiv.innerHTML += `<input type="button" value="Edit" onclick="editNote(${noteBox[i].id})">`
      //Creates new div for next entry
      document.getElementById("showNote").appendChild(newDiv);
   }
  }
}

function editNote(id){
  var note = document.getElementById(id); //Gets us the specified note
  note.innerHTML += `<textarea>${note.children[1].innerHTML}</textarea>` //adding the textare to the note
  note.innerHTML += `<input type="button" value="Save" onclick="saveEdit(${id})">` //adding the button to the note
}

function saveEdit(id){
   var note = document.getElementById(id);
   var edit = note.children[4].value; //getting the value from the textarea
   note.children[1].innerHTML = edit; //taking the value and displaying it as the value for the note
   db.exec(`UPDATE notes SET message = '${edit}' WHERE id = ${id}`) //updating the database
   var result = db.exec(`SELECT * FROM notes`);
    localStorage.noteBox = JSON.stringify(result); //adding the database to the localstorage
    note.children[5].remove(); //removes the save button
    note.children[4].remove(); //removes the textarea
}

function makeNotes(){
  var choices = document.getElementById("noteChoices").value;
  var uchoice = document.getElementById("searchTitle").value;
  var noteBox = JSON.parse(localStorage.noteBox);
  document.getElementById("showNote").innerHTML = "";
   for(var i=0; i < noteBox.length; i++){
     if(noteBox[i][choices] == uchoice){
        var newDiv = document.createElement("div");
        newDiv.id = noteBox[i].id;
        newDiv.className = "row";
        newDiv.style.backgroundColor = noteBox[i].color;
        newDiv.innerHTML += `<p>${noteBox[i].title}</p>`
        newDiv.innerHTML += `<p>${noteBox[i].message}</p>`
        newDiv.innerHTML += `<p>${noteBox[i].date}</p>`
        //Creates new div for next entry
        document.getElementById("showNote").appendChild(newDiv);
    }  
   }
  }


  function removeNote(){
    var input = document.getElementById("remove").value;
    var remove = db.exec(`DELETE FROM notes WHERE title = '${input}'`);

    if (remove == 0){
      alert("Title wasnt found")
    } else{
      var result = db.exec(`SELECT * FROM notes`);
      localStorage.noteBox = JSON.stringify(result);
      retrieveNote();
    }
  }  
    
    function archiveNote(){
      var input = document.getElementById("archive").value;
      var archive = db.exec(`SELECT * FROM notes WHERE title = '${input}'`);

      if (archive.length == 0){
      alert("Title wasnt found")
    } else{
      db.exec(`INSERT INTO archives VALUES(${archive[0].id}, "${archive[0].title}", "${archive[0].color}" ,"${archive[0].message}", "${archive[0].date}")`);
      var remove = db.exec(`DELETE FROM notes WHERE title = '${input}'`);
      var result = db.exec(`SELECT * FROM notes`);
      localStorage.noteBox = JSON.stringify(result);
       var result2 = db.exec(`SELECT * FROM notes`);
      localStorage.archiveNotes = JSON.stringify(result2);
      
      retrieveNote();
    }
    }

  


  function prioritizeNotes(){
    var noteBox = JSON.parse(localStorage.noteBox).slice().sort(function(a,b){
      let colors = ['red', 'yellow', 'green', 'gray'];
      var colorA = colors.findIndex(function(x){
        return x === a.color;
      });  
      var colorB = colors.findIndex(function(x){
        return x === b.color;
      });  
      return colorA - colorB; 
    });
    document.getElementById("showNote").innerHTML = "";
    for(var i=0; i < noteBox.length; i++){
        var newDiv = document.createElement("div");
        newDiv.id = noteBox[i].id;
        newDiv.className = "row";
        newDiv.style.backgroundColor = noteBox[i].color;
        newDiv.innerHTML += `<p>${noteBox[i].title}</p>`
        newDiv.innerHTML += `<p>${noteBox[i].message}</p>`
        newDiv.innerHTML += `<p>${noteBox[i].date}</p>`
        newDiv.innerHTML += `<input type="button" value="Edit" onclick="editNote(${noteBox[i].id})">`
        //Creates new div for next entry
        document.getElementById("showNote").appendChild(newDiv);
    }
  }


</script>
  </body>
</html>
